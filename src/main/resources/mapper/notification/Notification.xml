<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mungtrainer.mtserver.notification.dao.NotificationDAO">

    <insert id="insert"
            parameterType="com.mungtrainer.mtserver.notification.entity.Notification"
            useGeneratedKeys="true"
            keyProperty="notificationId">

        INSERT INTO notification (
        target_user_id,
        type,
        title,
        message,
        reference_id,
        reference_type,
        is_read,
        action_url,
        created_by,
        created_at,
        updated_by,
        updated_at
        ) VALUES (
        #{targetUserId},
        #{type},
        #{title},
        #{message},
        #{referenceId},
        #{referenceType},
        #{isRead},
        #{actionUrl},
        #{createdBy},
        NOW(),
        #{updatedBy},
        NOW()
        )

    </insert>

    <select id="findById"
            parameterType="long"
            resultType="com.mungtrainer.mtserver.notification.entity.Notification">
        SELECT
        notification_id,
        target_user_id,
        type,
        title,
        message,
        reference_id,
        reference_type,
        is_read,
        action_url,
        send_at,
        created_by,
        created_at,
        updated_by,
        updated_at,
        deleted_at,
        is_deleted
        FROM notification
        WHERE notification_id = #{notificationId}
        AND is_deleted = 0
    </select>


    <update id="markAsRead">
        UPDATE notification
        SET is_read = 1,
        updated_at = NOW(),
        updated_by = #{userId}
        WHERE notification_id = #{notificationId}
        AND target_user_id = #{userId}
        AND is_read = 0;
    </update>

    <select id="findAfterId"
            resultType="com.mungtrainer.mtserver.notification.entity.Notification">
        SELECT *
        FROM notification
        WHERE target_user_id = #{userId}
        AND notification_id > #{lastEventId}
        ORDER BY notification_id ASC
    </select>


</mapper>